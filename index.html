<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot VDM</title>

    <style>
        /* ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* Chat Container */
        .chat-container {
            width: 100%;
            max-width: 600px;
            height: 90vh;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            overflow: hidden;
        }

        /* Header */
        .chat-header {
            background: linear-gradient(90deg, #4c8bf5, #2b65d9);
            color: #ffffff;
            text-align: center;
            padding: 20px;
            font-size: 1.8rem;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* Chat Log */
        .chat-log {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f9f9f9;
        }

        .chat-message {
            margin: 10px 0;
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 15px;
            line-height: 1.5;
            word-wrap: break-word;
            font-size: 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .user-message {
            background: #4c8bf5;
            color: #ffffff;
            margin-left: auto;
        }

        .bot-message {
            background: #e4e6eb;
            color: #333333;
        }

        /* Typing Indicator */
        .typing-indicator {
            font-size: 1.1rem;
            color: #999;
            animation: typingDots 1s infinite steps(3);
        }

        @keyframes typingDots {

            0%,
            33% {
                content: ".";
            }

            66% {
                content: "..";
            }

            100% {
                content: "...";
            }
        }

        /* Chat Input Bar */
        .chat-input {
            display: flex;
            align-items: center;
            padding: 15px;
            border-top: 1px solid #ddd;
            background: #ffffff;
            box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.1);
        }

        .chat-input input {
            flex: 1;
            padding: 15px;
            border: 2px solid #4c8bf5;
            border-radius: 30px;
            font-size: 1rem;
            outline: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .chat-input button {
            margin-left: 10px;
            background: linear-gradient(90deg, #4c8bf5, #2b65d9);
            color: #ffffff;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .chat-input button:hover {
            background: #2b65d9;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .chat-header {
                font-size: 1.5rem;
                padding: 15px;
            }

            .chat-input input {
                font-size: 1rem;
                padding: 12px;
            }

            .chat-input button {
                font-size: 1rem;
                padding: 12px 18px;
            }
        }

        .chat-header {
            display: flex;
            flex-direction: row;
            /* ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
            align-items: center;
            /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
            justify-content: center;
            /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
            background: linear-gradient(90deg, #4c8bf5, #2b65d9);
            color: #ffffff;
            padding: 15px 10;
            font-size: 1.5rem;
            font-weight: bold;
            position: relative;
            
        }

        .center-logo {
              width: 100px;
            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ */
            height: auto;
            margin-right: 20px;
            /* ‡∏Ç‡∏¢‡∏±‡∏ö‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤ */
            margin-bottom: 5px;
            /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .header-text {
            text-align: center;
            font-size: 1.7rem;
        }
    </style>
</head>

<body>
    <div class="chat-container">
        <!-- Header -->
        <div class="chat-header">
            <img src="image/feed.jpg" alt="Logo" class="center-logo">
            <div class="header-text">VDM Genie</div>
        </div>

        <!-- Chat Log -->
        <div class="chat-log" id="chat-log"></div>

        <!-- Chat Input -->
        <div class="chat-input">
            <input type="text" id="user-input" placeholder="Type your message...">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        const apiUrl = "https://script.google.com/macros/s/AKfycbw8NmBDeYgjcH7R8j_WRkH-b7Y5z3w-T2OxZ85Y9uWj5fWg3ftsocUJx55053Q5k_tc/exec";



        let conversationContext = ""; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö Context ‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó
        function addMessage(sender, message, className) {
            const chatLog = document.getElementById("chat-log");
            const messageElement = document.createElement("div");
            messageElement.classList.add("chat-message", className);
            messageElement.textContent = `${message}`;
            chatLog.appendChild(messageElement);
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        async function logUserQuestion(message) {
            try {
                // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏õ‡∏ó‡∏µ‡πà API (POST)
                const response = await fetch(apiUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: `userInput=${encodeURIComponent(message)}`
                });
                const result = await response.json();

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á Context ‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                return `I don't quite understand the question you're asking. Can you please provide more specific words or details? üòä`;
            } catch (error) {
                console.error("There was an error saving the question:", error);
                return "An error occurred connecting to the database. ‚ùå";
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Bot ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
        function showTypingIndicator() {
            const chatLog = document.getElementById("chat-log");
            const typingIndicator = document.createElement("div");
            typingIndicator.classList.add("chat-message", "bot-message", "typing-indicator");
            typingIndicator.textContent = "..."; // ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏Ç‡πà‡∏õ‡∏•‡∏≤
            typingIndicator.id = "typing-indicator"; // ‡∏ï‡∏±‡πâ‡∏á ID ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏á‡πà‡∏≤‡∏¢
            chatLog.appendChild(typingIndicator);
            chatLog.scrollTop = chatLog.scrollHeight; // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏ä‡∏ó‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Bot ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById("typing-indicator");
            if (typingIndicator) {
                typingIndicator.remove(); // ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å DOM
            }
        }

        // Synonym Mapping (‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ñ‡∏≥‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á)
        const synonyms = {
            "hi": ["hello", "hey", "hiya"],
            "thanks": ["thank you", "thx", "appreciate"],
            "error": ["problem", "issue", "bug"],
            "stuck": ["freeze", "hang", "stop"]
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà Synonym
        function matchSynonyms(userInput, data) {
            const words = tokenize(userInput); // ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            for (let word of words) {
                for (let key in synonyms) {
                    if (synonyms[key].includes(word)) {
                        userInput = userInput.replace(word, key); // ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
                    }
                }
            }
            return userInput;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥
        function cleanText(text) {
            return text.toLowerCase().replace(/[^\w\s]/gi, '').trim();
        }

        function tokenize(text) {
            return cleanText(text).split(" "); // ‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô Array
        }


        function findClosestMatch(userInput, data) {
            let closestMatch = null;
            let highestSimilarity = 0;

            for (let item of data) {
                const similarity = calculateSimilarity(userInput, item.user);
                if (similarity > highestSimilarity) {
                    highestSimilarity = similarity;
                    closestMatch = item.answer;
                }
            }

            return highestSimilarity >= 0.5 ? closestMatch : null; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î threshold
        }

        function calculateSimilarity(str1, str2) {
            const words1 = str1.toLowerCase().split(" ");
            const words2 = str2.toLowerCase().split(" ");
            const matches = words1.filter(word => words2.includes(word));
            return matches.length / Math.max(words1.length, words2.length);
        }


        let conversationHistory = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

        let unknownResponseCount = 0; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà Bot ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à

        async function sendMessage() {
            const userInput = document.getElementById("user-input");
            let message = userInput.value.trim();

            if (message !== "") {
                addMessage("‡∏Ñ‡∏∏‡∏ì", message, "user-message");
                userInput.value = "";

                try {
                    showTypingIndicator(); // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Bot ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå

                    const response = await fetch(apiUrl);
                    const data = await response.json();

                    // ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• Context ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤‡∏Ñ‡∏≥‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    message = processContext(conversationHistory, message, data);

                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
                    let answer = findClosestMatch(message, data);

                    if (!answer) {
                        unknownResponseCount += 1; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏ñ‡πâ‡∏≤ Bot ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°

                        if (unknownResponseCount >= 2) {
                            answer = `Okay, I'm starting to confuse you. Just type in "I'm fine" and we'll start the conversation again.`;
                            unknownResponseCount = 0; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö
                        } else {
                            answer = await logUserQuestion(message);
                        }
                    } else {
                        unknownResponseCount = 0; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏´‡∏≤‡∏Å‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
                    }

                    hideTypingIndicator(); // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Bot ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå

                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤
                    conversationHistory.push({ user: message, bot: answer });

                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å Bot
                    addMessage("Bot", answer, "bot-message");
                } catch (error) {
                    hideTypingIndicator();
                    addMessage("Bot", "An error occurred connecting to the API. ‚ùå", "bot-message");
                }
            }
        }

        function processContext(history, message, data) {
            const userMessage = message.toLowerCase();

            // ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ Context ‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå
            const resetKeywords = ["thank you", "thanks", "hi", "hello", "ok", "done", "finish", "I'm fine"];

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏î‡∏à‡∏ö‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤
            if (resetKeywords.some(keyword => userMessage.includes(keyword))) {
                history.length = 0; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Context
                return message; // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡πÉ‡∏´‡∏°‡πà
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            for (let item of data) {
                if (userMessage.includes(item.user.toLowerCase())) {
                    history.length = 0; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Context ‡πÄ‡∏î‡∏¥‡∏°
                    return message; // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡πÉ‡∏´‡∏°‡πà
                }
            }

            // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö Context ‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏î‡∏à‡∏ö‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            if (history.length > 0) {
                const lastContext = history[history.length - 1].user; // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                return `${lastContext} ${message}`.trim(); // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            }

            return message; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ Context ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        document.getElementById("user-input").addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
                sendMessage();
            }
        });
    </script>
</body>

</html>
